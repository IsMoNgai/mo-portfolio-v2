import{r as d,j as G}from"./react-B5MDO8QK.js";import{L as Pe,T as We,R as Ut,U as qt,a as Vt,O as Ge,P as Ue,S as tt,b as Se,N as Xt,A as Yt,B as Zt,M as Kt,C as Jt,W as Qt,c as er,d as tr,e as rr,V as nr,f as N,g as vt,h as or,i as ir,D as sr,j as be,k as qe,l as ar,m as cr,E as ht,n as lr,o as ur,p as fr,q as ce,r as dr,s as pr,t as mr}from"./three-Bh3nDDSE.js";import{c as rt}from"./debounce-Dg93uZgN.js";import{F as vr,u as hr}from"./its-fine-DIIw4VH7.js";import{R as gr,c as ae}from"./react-reconciler-Cw807X9j.js";import{s as nt}from"./scheduler-CzFDRTuY.js";import{_ as Z}from"./@babel-CF3RwP-h.js";import{c as yr}from"./react-dom-C9nsoTc8.js";import{c as gt}from"./zustand-3hBhX-Hx.js";import"./maath-C-MIONH_.js";import{D as br,G as Ve,a as wr,M as Re,O as Er}from"./three-stdlib-BAjK6FTP.js";import{s as xr,p as Mr,c as Cr}from"./suspend-react-BKIKQNXN.js";const Xe={},_r=e=>void Object.assign(Xe,e);function Pr(e,t){function r(n,{args:i=[],attach:l,...p},g){let w=`${n[0].toUpperCase()}${n.slice(1)}`,v;if(n==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=p.object;v=ie(a,{type:n,root:g,attach:l,primitive:!0})}else{const a=Xe[w];if(!a)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(i))throw new Error("R3F: The args prop must be an array!");v=ie(new a(...i),{type:n,root:g,attach:l,memoizedProps:{args:i}})}return v.__r3f.attach===void 0&&(v instanceof Zt?v.__r3f.attach="geometry":v instanceof Kt&&(v.__r3f.attach="material")),w!=="inject"&&Ae(v,p),v}function o(n,i){let l=!1;if(i){var p,g;(p=i.__r3f)!=null&&p.attach?je(n,i,i.__r3f.attach):i.isObject3D&&n.isObject3D&&(n.add(i),l=!0),l||(g=n.__r3f)==null||g.objects.push(i),i.__r3f||ie(i,{}),i.__r3f.parent=n,$e(i),se(i)}}function c(n,i,l){let p=!1;if(i){var g,w;if((g=i.__r3f)!=null&&g.attach)je(n,i,i.__r3f.attach);else if(i.isObject3D&&n.isObject3D){i.parent=n,i.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:i});const v=n.children.filter(m=>m!==i),a=v.indexOf(l);n.children=[...v.slice(0,a),i,...v.slice(a)],p=!0}p||(w=n.__r3f)==null||w.objects.push(i),i.__r3f||ie(i,{}),i.__r3f.parent=n,$e(i),se(i)}}function s(n,i,l=!1){n&&[...n].forEach(p=>y(i,p,l))}function y(n,i,l){if(i){var p,g,w;if(i.__r3f&&(i.__r3f.parent=null),(p=n.__r3f)!=null&&p.objects&&(n.__r3f.objects=n.__r3f.objects.filter(_=>_!==i)),(g=i.__r3f)!=null&&g.attach)ct(n,i,i.__r3f.attach);else if(i.isObject3D&&n.isObject3D){var v;n.remove(i),(v=i.__r3f)!=null&&v.root&&zr(Me(i),i)}const m=(w=i.__r3f)==null?void 0:w.primitive,x=!m&&(l===void 0?i.dispose!==null:l);if(!m){var a;s((a=i.__r3f)==null?void 0:a.objects,i,x),s(i.children,i,x)}if(delete i.__r3f,x&&i.dispose&&i.type!=="Scene"){const _=()=>{try{i.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?nt.unstable_scheduleCallback(nt.unstable_IdlePriority,_):_()}se(n)}}function u(n,i,l,p){var g;const w=(g=n.__r3f)==null?void 0:g.parent;if(!w)return;const v=r(i,l,n.__r3f.root);if(n.children){for(const a of n.children)a.__r3f&&o(v,a);n.children=n.children.filter(a=>!a.__r3f)}n.__r3f.objects.forEach(a=>o(v,a)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||y(w,n),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),o(w,v),v.raycast&&v.__r3f.eventCount&&Me(v).getState().internal.interaction.push(v),[p,p.alternate].forEach(a=>{a!==null&&(a.stateNode=v,a.ref&&(typeof a.ref=="function"?a.ref(v):a.ref.current=v))})}const f=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:gr({createInstance:r,removeChild:y,appendChild:o,appendInitialChild:o,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,i)=>{if(!i)return;const l=n.getState().scene;l.__r3f&&(l.__r3f.root=n,o(l,i))},removeChildFromContainer:(n,i)=>{i&&y(n.getState().scene,i)},insertInContainerBefore:(n,i,l)=>{if(!i||!l)return;const p=n.getState().scene;p.__r3f&&c(p,i,l)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var i;return!!((i=n==null?void 0:n.__r3f)!=null?i:{}).handlers},prepareUpdate(n,i,l,p){var g;if(((g=n==null?void 0:n.__r3f)!=null?g:{}).primitive&&p.object&&p.object!==n)return[!0];{const{args:v=[],children:a,...m}=p,{args:x=[],children:_,...M}=l;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((S,O)=>S!==x[O]))return[!0];const E=Ct(n,m,M,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[i,l],p,g,w,v){i?u(n,p,w,v):Ae(n,l)},commitMount(n,i,l,p){var g;const w=(g=n.__r3f)!=null?g:{};n.raycast&&w.handlers&&w.eventCount&&Me(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ie(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var i;const{attach:l,parent:p}=(i=n.__r3f)!=null?i:{};l&&p&&ct(p,n,l),n.isObject3D&&(n.visible=!1),se(n)},unhideInstance(n,i){var l;const{attach:p,parent:g}=(l=n.__r3f)!=null?l:{};p&&g&&je(g,n,p),(n.isObject3D&&i.visible==null||i.visible)&&(n.visible=!0),se(n)},createTextInstance:f,hideTextInstance:f,unhideTextInstance:f,getCurrentEventPriority:()=>t?t():ae.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var ot,it;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,yt=()=>{var e;return(e=Xe.ColorManagement)!=null?e:null},bt=e=>e&&e.isOrthographicCamera,Sr=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((ot=window.document)!=null&&ot.createElement||((it=window.navigator)==null?void 0:it.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function wt(e){const t=d.useRef(e);return ve(()=>void(t.current=e),[e]),t}function Rr({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Et extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Et.getDerivedStateFromError=()=>({error:!0});const xt="__default",st=new Map,Or=e=>e&&!!e.memoized&&!!e.changes;function Mt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Me(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:o="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(L.str(e)||L.num(e)||L.boo(e))return e===t;const s=L.obj(e);if(s&&o==="reference")return e===t;const y=L.arr(e);if(y&&r==="reference")return e===t;if((y||s)&&e===t)return!0;let u;for(u in e)if(!(u in t))return!1;if(s&&r==="shallow"&&o==="shallow"){for(u in c?t:e)if(!L.equ(e[u],t[u],{strict:c,objects:"reference"}))return!1}else for(u in c?t:e)if(e[u]!==t[u])return!1;if(L.und(u)){if(y&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function jr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Ar(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ie(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Be(e,t){let r=e;if(t.includes("-")){const o=t.split("-"),c=o.pop();return r=o.reduce((s,y)=>s[y],e),{target:r,key:c}}else return{target:r,key:t}}const at=/-\d+$/;function je(e,t,r){if(L.str(r)){if(at.test(r)){const s=r.replace(at,""),{target:y,key:u}=Be(e,s);Array.isArray(y[u])||(y[u]=[])}const{target:o,key:c}=Be(e,r);t.__r3f.previousAttach=o[c],o[c]=t}else t.__r3f.previousAttach=r(e,t)}function ct(e,t,r){var o,c;if(L.str(r)){const{target:s,key:y}=Be(e,r),u=t.__r3f.previousAttach;u===void 0?delete s[y]:s[y]=u}else(o=t.__r3f)==null||o.previousAttach==null||o.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function Ct(e,{children:t,key:r,ref:o,...c},{children:s,key:y,ref:u,...f}={},h=!1){const n=e.__r3f,i=Object.entries(c),l=[];if(h){const g=Object.keys(f);for(let w=0;w<g.length;w++)c.hasOwnProperty(g[w])||i.unshift([g[w],xt+"remove"])}i.forEach(([g,w])=>{var v;if((v=e.__r3f)!=null&&v.primitive&&g==="object"||L.equ(w,f[g]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(g))return l.push([g,w,!0,[]]);let a=[];g.includes("-")&&(a=g.split("-")),l.push([g,w,!1,a]);for(const m in c){const x=c[m];m.startsWith(`${g}-`)&&l.push([m,x,!1,m.split("-")])}});const p={...c};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(p.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(p.attach=n.memoizedProps.attach),{memoized:p,changes:l}}const Tr=typeof process<"u"&&!1;function Ae(e,t){var r;const o=e.__r3f,c=o==null?void 0:o.root,s=c==null||c.getState==null?void 0:c.getState(),{memoized:y,changes:u}=Or(t)?t:Ct(e,t),f=o==null?void 0:o.eventCount;e.__r3f&&(e.__r3f.memoizedProps=y);for(let n=0;n<u.length;n++){let[i,l,p,g]=u[n];if(Oe(e)){const m="srgb",x="srgb-linear";i==="encoding"?(i="colorSpace",l=l===3001?m:x):i==="outputEncoding"&&(i="outputColorSpace",l=l===3001?m:x)}let w=e,v=w[i];if(g.length&&(v=g.reduce((a,m)=>a[m],e),!(v&&v.set))){const[a,...m]=g.reverse();w=m.reverse().reduce((x,_)=>x[_],e),i=a}if(l===xt+"remove")if(w.constructor){let a=st.get(w.constructor);a||(a=new w.constructor,st.set(w.constructor,a)),l=a[i]}else l=0;if(p&&o)l?o.handlers[i]=l:delete o.handlers[i],o.eventCount=Object.keys(o.handlers).length;else if(v&&v.set&&(v.copy||v instanceof Pe)){if(Array.isArray(l))v.fromArray?v.fromArray(l):v.set(...l);else if(v.copy&&l&&l.constructor&&(Tr?v.constructor.name===l.constructor.name:v.constructor===l.constructor))v.copy(l);else if(l!==void 0){const a=v instanceof Jt;!a&&v.setScalar?v.setScalar(l):v instanceof Pe&&l instanceof Pe?v.mask=l.mask:v.set(l),!yt()&&s&&!s.linear&&a&&v.convertSRGBToLinear()}}else if(w[i]=l,w[i]instanceof We&&w[i].format===Ut&&w[i].type===qt&&s){const a=w[i];Oe(a)&&Oe(s.gl)?a.colorSpace=s.gl.outputColorSpace:a.encoding=s.gl.outputEncoding}se(e)}if(o&&o.parent&&e.raycast&&f!==o.eventCount){const n=Me(e).getState().internal,i=n.interaction.indexOf(e);i>-1&&n.interaction.splice(i,1),o.eventCount&&n.interaction.push(e)}return!(u.length===1&&u[0][0]==="onUpdate")&&u.length&&(r=e.__r3f)!=null&&r.parent&&$e(e),e}function se(e){var t,r;const o=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();o&&o.internal.frames===0&&o.invalidate()}function $e(e){e.onUpdate==null||e.onUpdate(e)}function Lr(e,t){e.manual||(bt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Dr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ae.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ae.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ae.ContinuousEventPriority;default:return ae.DefaultEventPriority}}function _t(e,t,r,o){const c=r.get(t);c&&(r.delete(t),r.size===0&&(e.delete(o),c.target.releasePointerCapture(o)))}function zr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(o=>o!==t),r.initialHits=r.initialHits.filter(o=>o!==t),r.hovered.forEach((o,c)=>{(o.eventObject===t||o.object===t)&&r.hovered.delete(c)}),r.capturedMap.forEach((o,c)=>{_t(r.capturedMap,t,o,c)})}function kr(e){function t(f){const{internal:h}=e.getState(),n=f.offsetX-h.initialClick[0],i=f.offsetY-h.initialClick[1];return Math.round(Math.sqrt(n*n+i*i))}function r(f){return f.filter(h=>["Move","Over","Enter","Out","Leave"].some(n=>{var i;return(i=h.__r3f)==null?void 0:i.handlers["onPointer"+n]}))}function o(f,h){const n=e.getState(),i=new Set,l=[],p=h?h(n.internal.interaction):n.internal.interaction;for(let a=0;a<p.length;a++){const m=fe(p[a]);m&&(m.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(f,n);function g(a){const m=fe(a);if(!m||!m.events.enabled||m.raycaster.camera===null)return[];if(m.raycaster.camera===void 0){var x;m.events.compute==null||m.events.compute(f,m,(x=m.previousRoot)==null?void 0:x.getState()),m.raycaster.camera===void 0&&(m.raycaster.camera=null)}return m.raycaster.camera?m.raycaster.intersectObject(a,!0):[]}let w=p.flatMap(g).sort((a,m)=>{const x=fe(a.object),_=fe(m.object);return!x||!_?a.distance-m.distance:_.events.priority-x.events.priority||a.distance-m.distance}).filter(a=>{const m=we(a);return i.has(m)?!1:(i.add(m),!0)});n.events.filter&&(w=n.events.filter(w,n));for(const a of w){let m=a.object;for(;m;){var v;(v=m.__r3f)!=null&&v.eventCount&&l.push({...a,eventObject:m}),m=m.parent}}if("pointerId"in f&&n.internal.capturedMap.has(f.pointerId))for(let a of n.internal.capturedMap.get(f.pointerId).values())i.has(we(a.intersection))||l.push(a.intersection);return l}function c(f,h,n,i){const l=e.getState();if(f.length){const p={stopped:!1};for(const g of f){const w=fe(g.object)||l,{raycaster:v,pointer:a,camera:m,internal:x}=w,_=new N(a.x,a.y,0).unproject(m),M=P=>{var b,j;return(b=(j=x.capturedMap.get(P))==null?void 0:j.has(g.eventObject))!=null?b:!1},E=P=>{const b={intersection:g,target:h.target};x.capturedMap.has(P)?x.capturedMap.get(P).set(g.eventObject,b):x.capturedMap.set(P,new Map([[g.eventObject,b]])),h.target.setPointerCapture(P)},S=P=>{const b=x.capturedMap.get(P);b&&_t(x.capturedMap,g.eventObject,b,P)};let O={};for(let P in h){let b=h[P];typeof b!="function"&&(O[P]=b)}let C={...g,...O,pointer:a,intersections:f,stopped:p.stopped,delta:n,unprojectedPoint:_,ray:v.ray,camera:m,stopPropagation(){const P="pointerId"in h&&x.capturedMap.get(h.pointerId);if((!P||P.has(g.eventObject))&&(C.stopped=p.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(b=>b.eventObject===g.eventObject))){const b=f.slice(0,f.indexOf(g));s([...b,g])}},target:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:S},currentTarget:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:S},nativeEvent:h};if(i(C),p.stopped===!0)break}}return f}function s(f){const{internal:h}=e.getState();for(const n of h.hovered.values())if(!f.length||!f.find(i=>i.object===n.object&&i.index===n.index&&i.instanceId===n.instanceId)){const l=n.eventObject.__r3f,p=l==null?void 0:l.handlers;if(h.hovered.delete(we(n)),l!=null&&l.eventCount){const g={...n,intersections:f};p.onPointerOut==null||p.onPointerOut(g),p.onPointerLeave==null||p.onPointerLeave(g)}}}function y(f,h){for(let n=0;n<h.length;n++){const i=h[n].__r3f;i==null||i.handlers.onPointerMissed==null||i.handlers.onPointerMissed(f)}}function u(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return h=>{const{internal:n}=e.getState();"pointerId"in h&&n.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(h.pointerId)&&(n.capturedMap.delete(h.pointerId),s([]))})}}return function(n){const{onPointerMissed:i,internal:l}=e.getState();l.lastEvent.current=n;const p=f==="onPointerMove",g=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",v=o(n,p?r:void 0),a=g?t(n):0;f==="onPointerDown"&&(l.initialClick=[n.offsetX,n.offsetY],l.initialHits=v.map(x=>x.eventObject)),g&&!v.length&&a<=2&&(y(n,l.interaction),i&&i(n)),p&&s(v);function m(x){const _=x.eventObject,M=_.__r3f,E=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(p){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const S=we(x),O=l.hovered.get(S);O?O.stopped&&x.stopPropagation():(l.hovered.set(S,x),E.onPointerOver==null||E.onPointerOver(x),E.onPointerEnter==null||E.onPointerEnter(x))}E.onPointerMove==null||E.onPointerMove(x)}else{const S=E[f];S?(!g||l.initialHits.includes(_))&&(y(n,l.interaction.filter(O=>!l.initialHits.includes(O))),S(x)):g&&l.initialHits.includes(_)&&y(n,l.interaction.filter(O=>!l.initialHits.includes(O)))}}c(v,n,a,m)}}return{handlePointer:u}}const Pt=e=>!!(e!=null&&e.render),St=d.createContext(null),Fr=(e,t)=>{const r=gt((u,f)=>{const h=new N,n=new N,i=new N;function l(a=f().camera,m=n,x=f().size){const{width:_,height:M,top:E,left:S}=x,O=_/M;m instanceof N?i.copy(m):i.set(...m);const C=a.getWorldPosition(h).distanceTo(i);if(bt(a))return{width:_/a.zoom,height:M/a.zoom,top:E,left:S,factor:1,distance:C,aspect:O};{const P=a.fov*Math.PI/180,b=2*Math.tan(P/2)*C,j=b*(_/M);return{width:j,height:b,top:E,left:S,factor:_/j,distance:C,aspect:O}}}let p;const g=a=>u(m=>({performance:{...m.performance,current:a}})),w=new vt;return{set:u,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(f(),a),advance:(a,m)=>t(a,m,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new or,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=f();p&&clearTimeout(p),a.performance.current!==a.performance.min&&g(a.performance.min),p=setTimeout(()=>g(f().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:a=>u(m=>({...m,events:{...m.events,...a}})),setSize:(a,m,x,_,M)=>{const E=f().camera,S={width:a,height:m,top:_||0,left:M||0,updateStyle:x};u(O=>({size:S,viewport:{...O.viewport,...l(E,n,S)}}))},setDpr:a=>u(m=>{const x=Mt(a);return{viewport:{...m.viewport,dpr:x,initialDpr:m.viewport.initialDpr||x}}}),setFrameloop:(a="always")=>{const m=f().clock;m.stop(),m.elapsedTime=0,a!=="never"&&(m.start(),m.elapsedTime=0),u(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,m,x)=>{const _=f().internal;return _.priority=_.priority+(m>0?1:0),_.subscribers.push({ref:a,priority:m,store:x}),_.subscribers=_.subscribers.sort((M,E)=>M.priority-E.priority),()=>{const M=f().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(m>0?1:0),M.subscribers=M.subscribers.filter(E=>E.ref!==a))}}}}}),o=r.getState();let c=o.size,s=o.viewport.dpr,y=o.camera;return r.subscribe(()=>{const{camera:u,size:f,viewport:h,gl:n,set:i}=r.getState();if(f.width!==c.width||f.height!==c.height||h.dpr!==s){var l;c=f,s=h.dpr,Lr(u,f),n.setPixelRatio(h.dpr);const p=(l=f.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(f.width,f.height,p)}u!==y&&(y=u,i(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(u)}})))}),r.subscribe(u=>e(u)),r};let Ee,Ir=new Set,Hr=new Set,Wr=new Set;function Te(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function de(e,t){switch(e){case"before":return Te(Ir,t);case"after":return Te(Hr,t);case"tail":return Te(Wr,t)}}let Le,De;function ze(e,t,r){let o=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(o=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Le=t.internal.subscribers,Ee=0;Ee<Le.length;Ee++)De=Le[Ee],De.ref.current(De.store.getState(),o,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Br(e){let t=!1,r=!1,o,c,s;function y(h){c=requestAnimationFrame(y),t=!0,o=0,de("before",h),r=!0;for(const i of e.values()){var n;s=i.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((n=s.gl.xr)!=null&&n.isPresenting)&&(o+=ze(h,s))}if(r=!1,de("after",h),o===0)return de("tail",h),t=!1,cancelAnimationFrame(c)}function u(h,n=1){var i;if(!h)return e.forEach(l=>u(l.store.getState(),n));(i=h.gl.xr)!=null&&i.isPresenting||!h.internal.active||h.frameloop==="never"||(n>1?h.internal.frames=Math.min(60,h.internal.frames+n):r?h.internal.frames=2:h.internal.frames=1,t||(t=!0,requestAnimationFrame(y)))}function f(h,n=!0,i,l){if(n&&de("before",h),i)ze(h,i,l);else for(const p of e.values())ze(h,p.store.getState());n&&de("after",h)}return{loop:y,invalidate:u,advance:f}}function Rt(){const e=d.useContext(St);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function $(e=r=>r,t){return Rt()(e,t)}function he(e,t=0){const r=Rt(),o=r.getState().internal.subscribe,c=wt(e);return ve(()=>o(c,t,r),[t,o,r]),null}const lt=new WeakMap;function Ot(e,t){return function(r,...o){let c=lt.get(r);return c||(c=new r,lt.set(r,c)),e&&e(c),Promise.all(o.map(s=>new Promise((y,u)=>c.load(s,f=>{f.scene&&Object.assign(f,jr(f.scene)),y(f)},t,f=>u(new Error(`Could not load ${s}: ${f==null?void 0:f.message}`))))))}}function K(e,t,r,o){const c=Array.isArray(t)?t:[t],s=xr(Ot(r,o),[e,...c],{equal:L.equ});return Array.isArray(t)?s:s[0]}K.preload=function(e,t,r){const o=Array.isArray(t)?t:[t];return Mr(Ot(r),[e,...o])};K.clear=function(e,t){const r=Array.isArray(t)?t:[t];return Cr([e,...r])};const le=new Map,{invalidate:ut,advance:ft}=Br(le),{reconciler:Ce,applyProps:U}=Pr(le,Dr),oe={objects:"shallow",strict:!1},$r=(e,t)=>{const r=typeof e=="function"?e(t):e;return Pt(r)?r:new Qt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Nr(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:o,height:c,top:s,left:y,updateStyle:u=r}=t;return{width:o,height:c,top:s,left:y,updateStyle:u}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:c,top:s,left:y}=e.parentElement.getBoundingClientRect();return{width:o,height:c,top:s,left:y,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Gr(e){const t=le.get(e),r=t==null?void 0:t.fiber,o=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,s=o||Fr(ut,ft),y=r||Ce.createContainer(s,ae.ConcurrentRoot,null,!1,null,"",c,null);t||le.set(e,{fiber:y,store:s});let u,f=!1,h;return{configure(n={}){let{gl:i,size:l,scene:p,events:g,onCreated:w,shadows:v=!1,linear:a=!1,flat:m=!1,legacy:x=!1,orthographic:_=!1,frameloop:M="always",dpr:E=[1,2],performance:S,raycaster:O,camera:C,onPointerMissed:P}=n,b=s.getState(),j=b.gl;b.gl||b.set({gl:j=$r(i,e)});let I=b.raycaster;I||b.set({raycaster:I=new Vt});const{params:J,...z}=O||{};if(L.equ(z,I,oe)||U(I,{...z}),L.equ(J,I.params,oe)||U(I,{params:{...I.params,...J}}),!b.camera||b.camera===h&&!L.equ(h,C,oe)){h=C;const A=C instanceof er,T=A?C:_?new Ge(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);A||(T.position.z=5,C&&(U(T,C),("aspect"in C||"left"in C||"right"in C||"bottom"in C||"top"in C)&&(T.manual=!0,T.updateProjectionMatrix())),!b.camera&&!(C!=null&&C.rotation)&&T.lookAt(0,0,0)),b.set({camera:T}),I.camera=T}if(!b.scene){let A;p instanceof tt?A=p:(A=new tt,p&&U(A,p)),b.set({scene:ie(A)})}if(!b.xr){var q;const A=(R,Y)=>{const V=s.getState();V.frameloop!=="never"&&ft(R,!0,V,Y)},T=()=>{const R=s.getState();R.gl.xr.enabled=R.gl.xr.isPresenting,R.gl.xr.setAnimationLoop(R.gl.xr.isPresenting?A:null),R.gl.xr.isPresenting||ut(R)},F={connect(){const R=s.getState().gl;R.xr.addEventListener("sessionstart",T),R.xr.addEventListener("sessionend",T)},disconnect(){const R=s.getState().gl;R.xr.removeEventListener("sessionstart",T),R.xr.removeEventListener("sessionend",T)}};typeof((q=j.xr)==null?void 0:q.addEventListener)=="function"&&F.connect(),b.set({xr:F})}if(j.shadowMap){const A=j.shadowMap.enabled,T=j.shadowMap.type;if(j.shadowMap.enabled=!!v,L.boo(v))j.shadowMap.type=Se;else if(L.str(v)){var k;const F={basic:tr,percentage:rr,soft:Se,variance:nr};j.shadowMap.type=(k=F[v])!=null?k:Se}else L.obj(v)&&Object.assign(j.shadowMap,v);(A!==j.shadowMap.enabled||T!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const H=yt();H&&("enabled"in H?H.enabled=!x:"legacyMode"in H&&(H.legacyMode=x)),f||U(j,{outputEncoding:a?3e3:3001,toneMapping:m?Xt:Yt}),b.legacy!==x&&b.set(()=>({legacy:x})),b.linear!==a&&b.set(()=>({linear:a})),b.flat!==m&&b.set(()=>({flat:m})),i&&!L.fun(i)&&!Pt(i)&&!L.equ(i,j,oe)&&U(j,i),g&&!b.events.handlers&&b.set({events:g(s)});const W=Nr(e,l);return L.equ(W,b.size,oe)||b.setSize(W.width,W.height,W.updateStyle,W.top,W.left),E&&b.viewport.dpr!==Mt(E)&&b.setDpr(E),b.frameloop!==M&&b.setFrameloop(M),b.onPointerMissed||b.set({onPointerMissed:P}),S&&!L.equ(S,b.performance,oe)&&b.set(A=>({performance:{...A.performance,...S}})),u=w,f=!0,this},render(n){return f||this.configure(),Ce.updateContainer(G.jsx(Ur,{store:s,children:n,onCreated:u,rootElement:e}),y,null,()=>{}),s},unmount(){jt(e)}}}function Ur({store:e,children:t,onCreated:r,rootElement:o}){return ve(()=>{const c=e.getState();c.set(s=>({internal:{...s.internal,active:!0}})),r&&r(c),e.getState().events.connected||c.events.connect==null||c.events.connect(o)},[]),G.jsx(St.Provider,{value:e,children:t})}function jt(e,t){const r=le.get(e),o=r==null?void 0:r.fiber;if(o){const c=r==null?void 0:r.store.getState();c&&(c.internal.active=!1),Ce.updateContainer(null,o,null,()=>{c&&setTimeout(()=>{try{var s,y,u,f;c.events.disconnect==null||c.events.disconnect(),(s=c.gl)==null||(y=s.renderLists)==null||y.dispose==null||y.dispose(),(u=c.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(f=c.gl)!=null&&f.xr&&c.xr.disconnect(),Ar(c),le.delete(e)}catch{}},500)})}}Ce.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function qr(e){const{handlePointer:t}=kr(e);return{priority:1,enabled:!0,compute(r,o,c){o.pointer.set(r.offsetX/o.size.width*2-1,-(r.offsetY/o.size.height)*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,o)=>({...r,[o]:t(o)}),{}),update:()=>{var r;const{events:o,internal:c}=e.getState();(r=c.lastEvent)!=null&&r.current&&o.handlers&&o.handlers.onPointerMove(c.lastEvent.current)},connect:r=>{var o;const{set:c,events:s}=e.getState();s.disconnect==null||s.disconnect(),c(y=>({events:{...y.events,connected:r}})),Object.entries((o=s.handlers)!=null?o:[]).forEach(([y,u])=>{const[f,h]=ke[y];r.addEventListener(f,u,{passive:h})})},disconnect:()=>{const{set:r,events:o}=e.getState();if(o.connected){var c;Object.entries((c=o.handlers)!=null?c:[]).forEach(([s,y])=>{if(o&&o.connected instanceof HTMLElement){const[u]=ke[s];o.connected.removeEventListener(u,y)}}),r(s=>({events:{...s.events,connected:void 0}}))}}}}function Vr({debounce:e,scroll:t,polyfill:r,offsetSize:o}={debounce:0,scroll:!1,offsetSize:!1}){const c=r||typeof window<"u"&&window.ResizeObserver,[s,y]=d.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!c)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const u=d.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),f=e?typeof e=="number"?e:e.scroll:null,h=e?typeof e=="number"?e:e.resize:null,n=d.useRef(!1);d.useEffect(()=>(n.current=!0,()=>void(n.current=!1)));const[i,l,p]=d.useMemo(()=>{const a=()=>{if(!u.current.element)return;const{left:m,top:x,width:_,height:M,bottom:E,right:S,x:O,y:C}=u.current.element.getBoundingClientRect(),P={left:m,top:x,width:_,height:M,bottom:E,right:S,x:O,y:C};u.current.element instanceof HTMLElement&&o&&(P.height=u.current.element.offsetHeight,P.width=u.current.element.offsetWidth),Object.freeze(P),n.current&&!Kr(u.current.lastBounds,P)&&y(u.current.lastBounds=P)};return[a,h?rt(a,h):a,f?rt(a,f):a]},[y,o,f,h]);function g(){u.current.scrollContainers&&(u.current.scrollContainers.forEach(a=>a.removeEventListener("scroll",p,!0)),u.current.scrollContainers=null),u.current.resizeObserver&&(u.current.resizeObserver.disconnect(),u.current.resizeObserver=null)}function w(){u.current.element&&(u.current.resizeObserver=new c(p),u.current.resizeObserver.observe(u.current.element),t&&u.current.scrollContainers&&u.current.scrollContainers.forEach(a=>a.addEventListener("scroll",p,{capture:!0,passive:!0})))}const v=a=>{!a||a===u.current.element||(g(),u.current.element=a,u.current.scrollContainers=At(a),w())};return Yr(p,!!t),Xr(l),d.useEffect(()=>{g(),w()},[t,p,l]),d.useEffect(()=>g,[]),[v,s,i]}function Xr(e){d.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Yr(e,t){d.useEffect(()=>{if(t){const r=e;return window.addEventListener("scroll",r,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",r,!0)}},[e,t])}function At(e){const t=[];if(!e||e===document.body)return t;const{overflow:r,overflowX:o,overflowY:c}=window.getComputedStyle(e);return[r,o,c].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...At(e.parentElement)]}const Zr=["x","y","top","bottom","left","right","width","height"],Kr=(e,t)=>Zr.every(r=>e[r]===t[r]),Jr=d.forwardRef(function({children:t,fallback:r,resize:o,style:c,gl:s,events:y=qr,eventSource:u,eventPrefix:f,shadows:h,linear:n,flat:i,legacy:l,orthographic:p,frameloop:g,dpr:w,performance:v,raycaster:a,camera:m,scene:x,onPointerMissed:_,onCreated:M,...E},S){d.useMemo(()=>_r(ir),[]);const O=hr(),[C,P]=Vr({scroll:!0,debounce:{scroll:50,resize:0},...o}),b=d.useRef(null),j=d.useRef(null);d.useImperativeHandle(S,()=>b.current);const I=wt(_),[J,z]=d.useState(!1),[q,k]=d.useState(!1);if(J)throw J;if(q)throw q;const H=d.useRef(null);ve(()=>{const A=b.current;P.width>0&&P.height>0&&A&&(H.current||(H.current=Gr(A)),H.current.configure({gl:s,events:y,shadows:h,linear:n,flat:i,legacy:l,orthographic:p,frameloop:g,dpr:w,performance:v,raycaster:a,camera:m,scene:x,size:P,onPointerMissed:(...T)=>I.current==null?void 0:I.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(u?Sr(u)?u.current:u:j.current),f&&T.setEvents({compute:(F,R)=>{const Y=F[f+"X"],V=F[f+"Y"];R.pointer.set(Y/R.size.width*2-1,-(V/R.size.height)*2+1),R.raycaster.setFromCamera(R.pointer,R.camera)}}),M==null||M(T)}}),H.current.render(G.jsx(O,{children:G.jsx(Et,{set:k,children:G.jsx(d.Suspense,{fallback:G.jsx(Rr,{set:z}),children:t})})})))}),d.useEffect(()=>{const A=b.current;if(A)return()=>jt(A)},[]);const W=u?"none":"auto";return G.jsx("div",{ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...c},...E,children:G.jsx("div",{ref:C,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:b,style:{display:"block"},children:r})})})}),Sn=d.forwardRef(function(t,r){return G.jsx(vr,{children:G.jsx(Jr,{...t,ref:r})})}),ge=new N,Ye=new N,Qr=new N,dt=new vt;function en(e,t,r){const o=ge.setFromMatrixPosition(e.matrixWorld);o.project(t);const c=r.width/2,s=r.height/2;return[o.x*c+c,-(o.y*s)+s]}function tn(e,t){const r=ge.setFromMatrixPosition(e.matrixWorld),o=Ye.setFromMatrixPosition(t.matrixWorld),c=r.sub(o),s=t.getWorldDirection(Qr);return c.angleTo(s)>Math.PI/2}function rn(e,t,r,o){const c=ge.setFromMatrixPosition(e.matrixWorld),s=c.clone();s.project(t),dt.set(s.x,s.y),r.setFromCamera(dt,t);const y=r.intersectObjects(o,!0);if(y.length){const u=y[0].distance;return c.distanceTo(r.ray.origin)<u}return!0}function nn(e,t){if(t instanceof Ge)return t.zoom;if(t instanceof Ue){const r=ge.setFromMatrixPosition(e.matrixWorld),o=Ye.setFromMatrixPosition(t.matrixWorld),c=t.fov*Math.PI/180,s=r.distanceTo(o);return 1/(2*Math.tan(c/2)*s)}else return 1}function on(e,t,r){if(t instanceof Ue||t instanceof Ge){const o=ge.setFromMatrixPosition(e.matrixWorld),c=Ye.setFromMatrixPosition(t.matrixWorld),s=o.distanceTo(c),y=(r[1]-r[0])/(t.far-t.near),u=r[1]-y*t.far;return Math.round(y*s+u)}}const Ne=e=>Math.abs(e)<1e-10?0:e;function Tt(e,t,r=""){let o="matrix3d(";for(let c=0;c!==16;c++)o+=Ne(t[c]*e.elements[c])+(c!==15?",":")");return r+o}const sn=(e=>t=>Tt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),an=(e=>(t,r)=>Tt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function cn(e){return e&&typeof e=="object"&&"current"in e}const Rn=d.forwardRef(({children:e,eps:t=.001,style:r,className:o,prepend:c,center:s,fullscreen:y,portal:u,distanceFactor:f,sprite:h=!1,transform:n=!1,occlude:i,onOcclude:l,castShadow:p,receiveShadow:g,material:w,geometry:v,zIndexRange:a=[16777271,0],calculatePosition:m=en,as:x="div",wrapperClass:_,pointerEvents:M="auto",...E},S)=>{const{gl:O,camera:C,scene:P,size:b,raycaster:j,events:I,viewport:J}=$(),[z]=d.useState(()=>document.createElement(x)),q=d.useRef(),k=d.useRef(null),H=d.useRef(0),W=d.useRef([0,0]),A=d.useRef(null),T=d.useRef(null),F=(u==null?void 0:u.current)||I.connected||O.domElement.parentNode,R=d.useRef(null),Y=d.useRef(!1),V=d.useMemo(()=>i&&i!=="blending"||Array.isArray(i)&&i.length&&cn(i[0]),[i]);d.useLayoutEffect(()=>{const B=O.domElement;i&&i==="blending"?(B.style.zIndex=`${Math.floor(a[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[i]),d.useLayoutEffect(()=>{if(k.current){const B=q.current=yr(z);if(P.updateMatrixWorld(),n)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const D=m(k.current,C,b);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${D[0]}px,${D[1]}px,0);transform-origin:0 0;`}return F&&(c?F.prepend(z):F.appendChild(z)),()=>{F&&F.removeChild(z),B.unmount()}}},[F,n]),d.useLayoutEffect(()=>{_&&(z.className=_)},[_]);const Ke=d.useMemo(()=>n?{position:"absolute",top:0,left:0,width:b.width,height:b.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...y&&{top:-b.height/2,left:-b.width/2,width:b.width,height:b.height},...r},[r,s,y,b,n]),Ft=d.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);d.useLayoutEffect(()=>{if(Y.current=!1,n){var B;(B=q.current)==null||B.render(d.createElement("div",{ref:A,style:Ke},d.createElement("div",{ref:T,style:Ft},d.createElement("div",{ref:S,className:o,style:r,children:e}))))}else{var D;(D=q.current)==null||D.render(d.createElement("div",{ref:S,style:Ke,className:o,children:e}))}});const ne=d.useRef(!0);he(B=>{if(k.current){C.updateMatrixWorld(),k.current.updateWorldMatrix(!0,!1);const D=n?W.current:m(k.current,C,b);if(n||Math.abs(H.current-C.zoom)>t||Math.abs(W.current[0]-D[0])>t||Math.abs(W.current[1]-D[1])>t){const Q=tn(k.current,C);let X=!1;V&&(Array.isArray(i)?X=i.map(ee=>ee.current):i!=="blending"&&(X=[P]));const ue=ne.current;if(X){const ee=rn(k.current,C,j,X);ne.current=ee&&!Q}else ne.current=!Q;ue!==ne.current&&(l?l(!ne.current):z.style.display=ne.current?"block":"none");const ye=Math.floor(a[0]/2),It=i?V?[a[0],ye]:[ye-1,0]:a;if(z.style.zIndex=`${on(k.current,C,It)}`,n){const[ee,Qe]=[b.width/2,b.height/2],_e=C.projectionMatrix.elements[5]*Qe,{isOrthographicCamera:et,top:Ht,left:Wt,bottom:Bt,right:$t}=C,Nt=sn(C.matrixWorldInverse),Gt=et?`scale(${_e})translate(${Ne(-($t+Wt)/2)}px,${Ne((Ht+Bt)/2)}px)`:`translateZ(${_e}px)`;let te=k.current.matrixWorld;h&&(te=C.matrixWorldInverse.clone().transpose().copyPosition(te).scale(k.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),z.style.width=b.width+"px",z.style.height=b.height+"px",z.style.perspective=et?"":`${_e}px`,A.current&&T.current&&(A.current.style.transform=`${Gt}${Nt}translate(${ee}px,${Qe}px)`,T.current.style.transform=an(te,1/((f||10)/400)))}else{const ee=f===void 0?1:nn(k.current,C)*f;z.style.transform=`translate3d(${D[0]}px,${D[1]}px,0) scale(${ee})`}W.current=D,H.current=C.zoom}}if(!V&&R.current&&!Y.current)if(n){if(A.current){const D=A.current.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const{isOrthographicCamera:Q}=C;if(Q||v)E.scale&&(Array.isArray(E.scale)?E.scale instanceof N?R.current.scale.copy(E.scale.clone().divideScalar(1)):R.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):R.current.scale.setScalar(1/E.scale));else{const X=(f||10)/400,ue=D.clientWidth*X,ye=D.clientHeight*X;R.current.scale.set(ue,ye,1)}Y.current=!0}}}else{const D=z.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const Q=1/J.factor,X=D.clientWidth*Q,ue=D.clientHeight*Q;R.current.scale.set(X,ue,1),Y.current=!0}R.current.lookAt(B.camera.position)}});const Je=d.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return d.createElement("group",Z({},E,{ref:k}),i&&!V&&d.createElement("mesh",{castShadow:p,receiveShadow:g,ref:R},v||d.createElement("planeGeometry",null),w||d.createElement("shaderMaterial",{side:sr,vertexShader:Je.vertexShader,fragmentShader:Je.fragmentShader})))});let pe=0;const On=gt(e=>(be.onStart=(t,r,o)=>{e({active:!0,item:t,loaded:r,total:o,progress:(r-pe)/(o-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,o)=>{r===o&&(pe=o),e({active:!0,item:t,loaded:r,total:o,progress:(r-pe)/(o-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Fe=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Lt(e,t){const r=$(s=>s.gl),o=K(qe,Fe(e)?Object.values(e):e);return d.useLayoutEffect(()=>{t==null||t(o)},[t]),d.useEffect(()=>{if("initTexture"in r){let s=[];Array.isArray(o)?s=o:o instanceof We?s=[o]:Fe(o)&&(s=Object.values(o)),s.forEach(y=>{y instanceof We&&r.initTexture(y)})}},[r,o]),d.useMemo(()=>{if(Fe(e)){const s={};let y=0;for(const u in e)s[u]=o[y++];return s}else return o},[e,o])}Lt.preload=e=>K.preload(qe,e);Lt.clear=e=>K.clear(qe,e);const ln=()=>parseInt(ar.replace(/\D+/g,"")),Dt=ln();function un(e){return Array.isArray(e)}function Ie(e=[0,0,0]){return un(e)?e:e instanceof N||e instanceof ht?[e.x,e.y,e.z]:[e,e,e]}const jn=d.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:o=-10,map:c,mesh:s,children:y,position:u,rotation:f,scale:h,...n},i){const l=d.useRef(null);d.useImperativeHandle(i,()=>l.current);const p=d.useRef(null);return d.useLayoutEffect(()=>{const g=(s==null?void 0:s.current)||l.current.parent,w=l.current;if(!(g instanceof cr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const v={position:new N,rotation:new ht,scale:new N(1,1,1)};if(g){U(v,{position:u,scale:h});const a=g.matrixWorld.clone();if(g.matrixWorld.identity(),!f||typeof f=="number"){const m=new lr;m.position.copy(v.position),m.lookAt(g.position),typeof f=="number"&&m.rotateZ(f),U(v,{rotation:m.rotation})}else U(v,{rotation:f});return w.geometry=new br(g,v.position,v.rotation,v.scale),p.current&&(U(p.current,v),p.current.traverse(m=>m.raycast=()=>null)),g.matrixWorld=a,()=>{w.geometry.dispose()}}},[s,...Ie(u),...Ie(h),...Ie(f)]),d.createElement("mesh",Z({ref:l,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":o,"material-depthTest":r,"material-map":c},n),y,t&&d.createElement("mesh",{ref:p},d.createElement("boxGeometry",null),d.createElement("meshNormalMaterial",{wireframe:!0}),d.createElement("axesHelper",null)))});let xe=null,zt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function kt(e,t,r){return o=>{r&&r(o),e&&(xe||(xe=new wr),xe.setDecoderPath(typeof e=="string"?e:zt),o.setDRACOLoader(xe)),t&&o.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function Ze(e,t=!0,r=!0,o){return K(Ve,e,kt(t,r,o))}Ze.preload=(e,t=!0,r=!0,o)=>K.preload(Ve,e,kt(t,r,o));Ze.clear=e=>K.clear(Ve,e);Ze.setDecoderPath=e=>{zt=e};const An=d.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:o,enableDamping:c=!0,keyEvents:s=!1,onChange:y,onStart:u,onEnd:f,...h},n)=>{const i=$(E=>E.invalidate),l=$(E=>E.camera),p=$(E=>E.gl),g=$(E=>E.events),w=$(E=>E.setEvents),v=$(E=>E.set),a=$(E=>E.get),m=$(E=>E.performance),x=t||l,_=o||g.connected||p.domElement,M=d.useMemo(()=>new Er(x),[x]);return he(()=>{M.enabled&&M.update()},-1),d.useEffect(()=>(s&&M.connect(s===!0?_:s),M.connect(_),()=>void M.dispose()),[s,_,r,M,i]),d.useEffect(()=>{const E=C=>{i(),r&&m.regress(),y&&y(C)},S=C=>{u&&u(C)},O=C=>{f&&f(C)};return M.addEventListener("change",E),M.addEventListener("start",S),M.addEventListener("end",O),()=>{M.removeEventListener("start",S),M.removeEventListener("end",O),M.removeEventListener("change",E)}},[y,u,f,M,i,w]),d.useEffect(()=>{if(e){const E=a().controls;return v({controls:M}),()=>v({controls:E})}},[e,M]),d.createElement("primitive",Z({ref:n,object:M,enableDamping:c},h))}),He=Dt>=154?"opaque_fragment":"output_fragment";class fn extends ur{constructor(t){super(t),this.onBeforeCompile=(r,o)=>{const{isWebGL2:c}=o.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${He}>`,`
        ${c?`#include <${He}>`:`#extension GL_OES_standard_derivatives : enable
#include <${He}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Dt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Tn=d.forwardRef((e,t)=>{const[r]=d.useState(()=>new fn(null));return d.createElement("primitive",Z({},e,{object:r,ref:t,attach:"material"}))}),Ln=d.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:o=1,floatIntensity:c=1,floatingRange:s=[-.1,.1],autoInvalidate:y=!1,...u},f)=>{const h=d.useRef(null);d.useImperativeHandle(f,()=>h.current,[]);const n=d.useRef(Math.random()*1e4);return he(i=>{var l,p;if(!t||r===0)return;y&&i.invalidate();const g=n.current+i.clock.getElapsedTime();h.current.rotation.x=Math.cos(g/4*r)/8*o,h.current.rotation.y=Math.sin(g/4*r)/8*o,h.current.rotation.z=Math.sin(g/4*r)/20*o;let w=Math.sin(g/4*r)/10;w=fr.mapLinear(w,-.1,.1,(l=s==null?void 0:s[0])!==null&&l!==void 0?l:-.1,(p=s==null?void 0:s[1])!==null&&p!==void 0?p:.1),h.current.position.y=w*c,h.current.updateMatrix()}),d.createElement("group",u,d.createElement("group",{ref:h,matrixAutoUpdate:!1},e))});let re,me;const dn=d.createContext(null),pt=new dr,mt=new N,pn=d.forwardRef(({children:e,range:t,limit:r=1e3,...o},c)=>{const s=d.useRef(null);d.useImperativeHandle(c,()=>s.current,[]);const[y,u]=d.useState([]),[[f,h,n]]=d.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);d.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),pt.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,y.length),re=0;re<y.length;re++)me=y[re].current,me.getWorldPosition(mt).applyMatrix4(pt),mt.toArray(f,re*3),s.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(h,re*3),s.current.geometry.attributes.color.needsUpdate=!0,n.set([me.size],re),s.current.geometry.attributes.size.needsUpdate=!0});const i=d.useMemo(()=>({getParent:()=>s,subscribe:l=>(u(p=>[...p,l]),()=>u(p=>p.filter(g=>g.current!==l.current)))}),[]);return d.createElement("points",Z({userData:{instances:y},matrixAutoUpdate:!1,ref:s,raycast:()=>null},o),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:f.length/3,array:f,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-color",count:h.length/3,array:h,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ce})),d.createElement(dn.Provider,{value:i},e))}),mn=d.forwardRef(({children:e,positions:t,colors:r,sizes:o,stride:c=3,...s},y)=>{const u=d.useRef(null);return d.useImperativeHandle(y,()=>u.current,[]),he(()=>{const f=u.current.geometry.attributes;f.position.needsUpdate=!0,r&&(f.color.needsUpdate=!0),o&&(f.size.needsUpdate=!0)}),d.createElement("points",Z({ref:u},s),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/c,array:t,itemSize:c,usage:ce}),r&&d.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/c,array:r,itemSize:3,usage:ce}),o&&d.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/c,array:o,itemSize:1,usage:ce})),e)}),Dn=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement(mn,Z({},e,{ref:t})):d.createElement(pn,Z({},e,{ref:t})));function zn({all:e,scene:t,camera:r}){const o=$(({gl:y})=>y),c=$(({camera:y})=>y),s=$(({scene:y})=>y);return d.useLayoutEffect(()=>{const y=[];e&&(t||s).traverse(h=>{h.visible===!1&&(y.push(h),h.visible=!0)}),o.compile(t||s,r||c);const u=new pr(128);new mr(.01,1e5,u).update(o,t||s),u.dispose(),y.forEach(h=>h.visible=!1)},[]),null}export{Sn as C,jn as D,Ln as F,Rn as H,An as O,zn as P,Lt as a,he as b,Dn as c,Tn as d,Ze as e,On as u};
